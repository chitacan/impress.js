<!DOCTYPE html>  <html> <head>   <title>impress.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               impress.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * impress.js</span>
<span class="cm"> *</span>
<span class="cm"> * impress.js is a presentation tool based on the power of CSS3 transforms and transitions</span>
<span class="cm"> * in modern browsers and inspired by the idea behind prezi.com.</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 2011-2012 Bartek Szopka (@bartaz)</span>
<span class="cm"> *</span>
<span class="cm"> * Released under the MIT and GPL Licenses.</span>
<span class="cm"> *</span>
<span class="cm"> * ------------------------------------------------</span>
<span class="cm"> *  author:  Bartek Szopka</span>
<span class="cm"> *  version: 0.5.3</span>
<span class="cm"> *  url:     http://bartaz.github.com/impress.js/</span>
<span class="cm"> *  source:  http://github.com/bartaz/impress.js/</span>
<span class="cm"> */</span>

<span class="cm">/*jshint bitwise:true, curly:true, eqeqeq:true, forin:true, latedef:true, newcap:true,</span>
<span class="cm">         noarg:true, noempty:true, undef:true, strict:true, browser:true */</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>You are one of those who like to know how thing work inside?
Let me show you the cogs that make impress.js run...</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span> <span class="nb">document</span><span class="p">,</span> <span class="nb">window</span> <span class="p">)</span> <span class="p">{</span>
    <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>HELPER FUNCTIONS</p>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p><code>pfx</code> is a function that takes a standard CSS property name as a parameter
and returns it's prefixed version valid for current browser it runs in.
The code is heavily inspired by Modernizr http://www.modernizr.com/</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">pfx</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        
        <span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;dummy&#39;</span><span class="p">).</span><span class="nx">style</span><span class="p">,</span>
            <span class="nx">prefixes</span> <span class="o">=</span> <span class="s1">&#39;Webkit Moz O ms Khtml&#39;</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">),</span>
            <span class="nx">memory</span> <span class="o">=</span> <span class="p">{};</span>
        
        <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">prop</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">memory</span><span class="p">[</span> <span class="nx">prop</span> <span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="p">)</span> <span class="p">{</span>
                
                <span class="kd">var</span> <span class="nx">ucProp</span>  <span class="o">=</span> <span class="nx">prop</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">+</span> <span class="nx">prop</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                    <span class="nx">props</span>   <span class="o">=</span> <span class="p">(</span><span class="nx">prop</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">prefixes</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">ucProp</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">ucProp</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span>
                
                <span class="nx">memory</span><span class="p">[</span> <span class="nx">prop</span> <span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">props</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span> <span class="nx">style</span><span class="p">[</span> <span class="nx">props</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">]</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="p">)</span> <span class="p">{</span>
                        <span class="nx">memory</span><span class="p">[</span> <span class="nx">prop</span> <span class="p">]</span> <span class="o">=</span> <span class="nx">props</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            
            <span class="p">}</span>
            
            <span class="k">return</span> <span class="nx">memory</span><span class="p">[</span> <span class="nx">prop</span> <span class="p">];</span>
        <span class="p">};</span>
    
    <span class="p">})();</span>
    </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p><code>arraify</code> takes an array-like object and turns it into real Array
to make all the Array.prototype goodness available.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">arrayify</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">a</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="nx">a</span> <span class="p">);</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p><code>css</code> function applies the styles given in <code>props</code> object to the element
given as <code>el</code>. It runs all property names through <code>pfx</code> function to make
sure proper prefixed version of the property is used.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">css</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">props</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">pkey</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">props</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nx">props</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nx">pkey</span> <span class="o">=</span> <span class="nx">pfx</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span> <span class="nx">pkey</span> <span class="o">!==</span> <span class="kc">null</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">pkey</span><span class="p">]</span> <span class="o">=</span> <span class="nx">props</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">el</span><span class="p">;</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p><code>toNumber</code> takes a value given as <code>numeric</code> parameter and tries to turn
it into a number. If it is not possible it returns 0 (or other value
given as <code>fallback</code>).</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">toNumber</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">numeric</span><span class="p">,</span> <span class="nx">fallback</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">numeric</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="nx">fallback</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">numeric</span><span class="p">);</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p><code>byId</code> returns element with given <code>id</code> - you probably have guessed that ;)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">byId</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">id</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p><code>$</code> returns first element for given CSS <code>selector</code> in the <code>context</code> of
the given element or whole document.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">$</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">context</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">context</span> <span class="o">=</span> <span class="nx">context</span> <span class="o">||</span> <span class="nb">document</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p><code>$$</code> return an array of elements for given CSS <code>selector</code> in the <code>context</code> of
the given element or whole document.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">$$</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">context</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">context</span> <span class="o">=</span> <span class="nx">context</span> <span class="o">||</span> <span class="nb">document</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">arrayify</span><span class="p">(</span> <span class="nx">context</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">);</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p><code>triggerEvent</code> builds a custom DOM event with given <code>eventName</code> and <code>detail</code> data
and triggers it on element given as <code>el</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">triggerEvent</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">detail</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createEvent</span><span class="p">(</span><span class="s2">&quot;CustomEvent&quot;</span><span class="p">);</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">initCustomEvent</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">detail</span><span class="p">);</span>
        <span class="nx">el</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p><code>translate</code> builds a translate transform string for given data.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">translate</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">t</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot; translate3d(&quot;</span> <span class="o">+</span> <span class="nx">t</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s2">&quot;px,&quot;</span> <span class="o">+</span> <span class="nx">t</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="s2">&quot;px,&quot;</span> <span class="o">+</span> <span class="nx">t</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="s2">&quot;px) &quot;</span><span class="p">;</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p><code>rotate</code> builds a rotate transform string for given data.
By default the rotations are in X Y Z order that can be reverted by passing <code>true</code>
as second parameter.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">rotate</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">revert</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">rX</span> <span class="o">=</span> <span class="s2">&quot; rotateX(&quot;</span> <span class="o">+</span> <span class="nx">r</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="s2">&quot;deg) &quot;</span><span class="p">,</span>
            <span class="nx">rY</span> <span class="o">=</span> <span class="s2">&quot; rotateY(&quot;</span> <span class="o">+</span> <span class="nx">r</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="s2">&quot;deg) &quot;</span><span class="p">,</span>
            <span class="nx">rZ</span> <span class="o">=</span> <span class="s2">&quot; rotateZ(&quot;</span> <span class="o">+</span> <span class="nx">r</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="s2">&quot;deg) &quot;</span><span class="p">;</span>
        
        <span class="k">return</span> <span class="nx">revert</span> <span class="o">?</span> <span class="nx">rZ</span><span class="o">+</span><span class="nx">rY</span><span class="o">+</span><span class="nx">rX</span> <span class="o">:</span> <span class="nx">rX</span><span class="o">+</span><span class="nx">rY</span><span class="o">+</span><span class="nx">rZ</span><span class="p">;</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p><code>scale</code> builds a scale transform string for given data.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">scale</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">s</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot; scale(&quot;</span> <span class="o">+</span> <span class="nx">s</span> <span class="o">+</span> <span class="s2">&quot;) &quot;</span><span class="p">;</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p><code>perspective</code> builds a perspective transform string for given data.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">perspective</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">p</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot; perspective(&quot;</span> <span class="o">+</span> <span class="nx">p</span> <span class="o">+</span> <span class="s2">&quot;px) &quot;</span><span class="p">;</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p><code>getElementFromHash</code> returns an element located by id from hash part of
window location.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">getElementFromHash</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>get id from url # by removing <code>#</code> or <code>#/</code> from the beginning,
so both "fallback" <code>#slide-id</code> and "enhanced" <code>#/slide-id</code> will work</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="nx">byId</span><span class="p">(</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^#\/?/</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">);</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p><code>computeWindowScale</code> counts the scale factor between window size and size
defined for the presentation in the config.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">computeWindowScale</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">config</span> <span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">hScale</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="o">/</span> <span class="nx">config</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span>
            <span class="nx">wScale</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">/</span> <span class="nx">config</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
            <span class="nx">scale</span> <span class="o">=</span> <span class="nx">hScale</span> <span class="o">&gt;</span> <span class="nx">wScale</span> <span class="o">?</span> <span class="nx">wScale</span> <span class="o">:</span> <span class="nx">hScale</span><span class="p">;</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">maxScale</span> <span class="o">&amp;&amp;</span> <span class="nx">scale</span> <span class="o">&gt;</span> <span class="nx">config</span><span class="p">.</span><span class="nx">maxScale</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">scale</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">maxScale</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">minScale</span> <span class="o">&amp;&amp;</span> <span class="nx">scale</span> <span class="o">&lt;</span> <span class="nx">config</span><span class="p">.</span><span class="nx">minScale</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">scale</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">minScale</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="nx">scale</span><span class="p">;</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>CHECK SUPPORT</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
    
    <span class="kd">var</span> <span class="nx">ua</span> <span class="o">=</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">impressSupported</span> <span class="o">=</span> </pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>browser should support CSS 3D transtorms </p>             </td>             <td class="code">               <div class="highlight"><pre>                           <span class="p">(</span> <span class="nx">pfx</span><span class="p">(</span><span class="s2">&quot;perspective&quot;</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">null</span> <span class="p">)</span> <span class="o">&amp;&amp;</span>
                           </pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>and <code>classList</code> and <code>dataset</code> APIs</p>             </td>             <td class="code">               <div class="highlight"><pre>                           <span class="p">(</span> <span class="nx">body</span><span class="p">.</span><span class="nx">classList</span> <span class="p">)</span> <span class="o">&amp;&amp;</span>
                           <span class="p">(</span> <span class="nx">body</span><span class="p">.</span><span class="nx">dataset</span> <span class="p">)</span> <span class="o">&amp;&amp;</span>
                           </pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>but some mobile devices need to be blacklisted,
because their CSS 3D support or hardware is not
good enough to run impress.js properly, sorry...</p>             </td>             <td class="code">               <div class="highlight"><pre>                           <span class="p">(</span> <span class="nx">ua</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="sr">/(iphone)|(ipod)|(android)/</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span> <span class="p">);</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">impressSupported</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>we can't be sure that <code>classList</code> is supported</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">body</span><span class="p">.</span><span class="nx">className</span> <span class="o">+=</span> <span class="s2">&quot; impress-not-supported &quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">body</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">&quot;impress-not-supported&quot;</span><span class="p">);</span>
        <span class="nx">body</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;impress-supported&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>GLOBALS AND DEFAULTS</p>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>This is were the root elements of all impress.js instances will be kept.
Yes, this means you can have more than one instance on a page, but I'm not
sure if it makes any sense in practice ;)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">roots</span> <span class="o">=</span> <span class="p">{};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>some default config values.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">width</span><span class="o">:</span> <span class="mi">1024</span><span class="p">,</span>
        <span class="nx">height</span><span class="o">:</span> <span class="mi">768</span><span class="p">,</span>
        <span class="nx">maxScale</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">minScale</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        
        <span class="nx">perspective</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span>
        
        <span class="nx">transitionDuration</span><span class="o">:</span> <span class="mi">1000</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>it's just an empty function ... and a useless comment.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">empty</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>IMPRESS.JS API</p>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>And that's where interesting things will start to happen.
It's the core <code>impress</code> function that returns the impress.js API
for a presentation based on the element with given id ('impress'
by default).</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">impress</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">impress</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">rootId</span> <span class="p">)</span> <span class="p">{</span>
        </pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>If impress.js is not supported by the browser return a dummy API
it may not be a perfect solution but we return early and avoid
running code that may use features not implemented in the browser.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">impressSupported</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="nx">init</span><span class="o">:</span> <span class="nx">empty</span><span class="p">,</span>
                <span class="kr">goto</span><span class="o">:</span> <span class="nx">empty</span><span class="p">,</span>
                <span class="nx">prev</span><span class="o">:</span> <span class="nx">empty</span><span class="p">,</span>
                <span class="nx">next</span><span class="o">:</span> <span class="nx">empty</span>
            <span class="p">};</span>
        <span class="p">}</span>
        
        <span class="nx">rootId</span> <span class="o">=</span> <span class="nx">rootId</span> <span class="o">||</span> <span class="s2">&quot;impress&quot;</span><span class="p">;</span>
        </pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>if given root is already initialized just return the API</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">roots</span><span class="p">[</span><span class="s2">&quot;impress-root-&quot;</span> <span class="o">+</span> <span class="nx">rootId</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">roots</span><span class="p">[</span><span class="s2">&quot;impress-root-&quot;</span> <span class="o">+</span> <span class="nx">rootId</span><span class="p">];</span>
        <span class="p">}</span>
        </pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>data of all presentation steps</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">stepsData</span> <span class="o">=</span> <span class="p">{};</span>
        </pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>element of currently active step</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">activeStep</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        </pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>current state (position, rotation and scale) of the presentation</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">currentState</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        </pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>array of step elements</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">steps</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        </pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>configuration options</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        </pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>scale factor of the browser window</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">windowScale</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>        
        </pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>root presentation elements</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="nx">byId</span><span class="p">(</span> <span class="nx">rootId</span> <span class="p">);</span>
        <span class="kd">var</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span>
        
        <span class="kd">var</span> <span class="nx">initialized</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        </pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>STEP EVENTS</p>

<p>There are currently two step events triggered by impress.js
<code>impress:stepenter</code> is triggered when the step is shown on the 
screen (the transition from the previous one is finished) and
<code>impress:stepleave</code> is triggered when the step is left (the
transition to next step just starts).</p>             </td>             <td class="code">               <div class="highlight"><pre>        </pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>reference to last entered step</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">lastEntered</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        </pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p><code>onStepEnter</code> is called whenever the step element is entered
but the event is triggered only if the step is different than
last entered step.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">onStepEnter</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">step</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">lastEntered</span> <span class="o">!==</span> <span class="nx">step</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">triggerEvent</span><span class="p">(</span><span class="nx">step</span><span class="p">,</span> <span class="s2">&quot;impress:stepenter&quot;</span><span class="p">);</span>
                <span class="nx">lastEntered</span> <span class="o">=</span> <span class="nx">step</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">};</span>
        </pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p><code>onStepLeave</code> is called whenever the step element is left
but the event is triggered only if the step is the same as
last entered step.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">onStepLeave</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">step</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">lastEntered</span> <span class="o">===</span> <span class="nx">step</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">triggerEvent</span><span class="p">(</span><span class="nx">step</span><span class="p">,</span> <span class="s2">&quot;impress:stepleave&quot;</span><span class="p">);</span>
                <span class="nx">lastEntered</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">};</span>
        </pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p><code>initStep</code> initializes given step element by reading data from its
data attributes and setting correct styles.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">initStep</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">idx</span> <span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">dataset</span><span class="p">,</span>
                <span class="nx">step</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="nx">translate</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">x</span><span class="o">:</span> <span class="nx">toNumber</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span>
                        <span class="nx">y</span><span class="o">:</span> <span class="nx">toNumber</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span>
                        <span class="nx">z</span><span class="o">:</span> <span class="nx">toNumber</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span>
                    <span class="p">},</span>
                    <span class="nx">rotate</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">x</span><span class="o">:</span> <span class="nx">toNumber</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">rotateX</span><span class="p">),</span>
                        <span class="nx">y</span><span class="o">:</span> <span class="nx">toNumber</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">rotateY</span><span class="p">),</span>
                        <span class="nx">z</span><span class="o">:</span> <span class="nx">toNumber</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">rotateZ</span> <span class="o">||</span> <span class="nx">data</span><span class="p">.</span><span class="nx">rotate</span><span class="p">)</span>
                    <span class="p">},</span>
                    <span class="nx">scale</span><span class="o">:</span> <span class="nx">toNumber</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">scale</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="nx">el</span><span class="o">:</span> <span class="nx">el</span>
                <span class="p">};</span>
            
            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">el</span><span class="p">.</span><span class="nx">id</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nx">el</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s2">&quot;step-&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>
            
            <span class="nx">stepsData</span><span class="p">[</span><span class="s2">&quot;impress-&quot;</span> <span class="o">+</span> <span class="nx">el</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">step</span><span class="p">;</span>
            
            <span class="nx">css</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">position</span><span class="o">:</span> <span class="s2">&quot;absolute&quot;</span><span class="p">,</span>
                <span class="nx">transform</span><span class="o">:</span> <span class="s2">&quot;translate(-50%,-50%)&quot;</span> <span class="o">+</span>
                           <span class="nx">translate</span><span class="p">(</span><span class="nx">step</span><span class="p">.</span><span class="nx">translate</span><span class="p">)</span> <span class="o">+</span>
                           <span class="nx">rotate</span><span class="p">(</span><span class="nx">step</span><span class="p">.</span><span class="nx">rotate</span><span class="p">)</span> <span class="o">+</span>
                           <span class="nx">scale</span><span class="p">(</span><span class="nx">step</span><span class="p">.</span><span class="nx">scale</span><span class="p">),</span>
                <span class="nx">transformStyle</span><span class="o">:</span> <span class="s2">&quot;preserve-3d&quot;</span>
            <span class="p">});</span>
        <span class="p">};</span>
        </pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p><code>init</code> API function that initializes (and runs) the presentation.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">initialized</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
            </pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>First we set up the viewport for mobile devices.
For some reason iPad goes nuts when it is not done properly.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">meta</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;meta[name=&#39;viewport&#39;]&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;meta&quot;</span><span class="p">);</span>
            <span class="nx">meta</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="s2">&quot;width=device-width, minimum-scale=1, maximum-scale=1, user-scalable=no&quot;</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">meta</span><span class="p">.</span><span class="nx">parentNode</span> <span class="o">!==</span> <span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">meta</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;viewport&#39;</span><span class="p">;</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">meta</span><span class="p">);</span>
            <span class="p">}</span>
            </pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>initialize configuration object</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">rootData</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">dataset</span><span class="p">;</span>
            <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">width</span><span class="o">:</span> <span class="nx">toNumber</span><span class="p">(</span> <span class="nx">rootData</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">defaults</span><span class="p">.</span><span class="nx">width</span> <span class="p">),</span>
                <span class="nx">height</span><span class="o">:</span> <span class="nx">toNumber</span><span class="p">(</span> <span class="nx">rootData</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span> <span class="nx">defaults</span><span class="p">.</span><span class="nx">height</span> <span class="p">),</span>
                <span class="nx">maxScale</span><span class="o">:</span> <span class="nx">toNumber</span><span class="p">(</span> <span class="nx">rootData</span><span class="p">.</span><span class="nx">maxScale</span><span class="p">,</span> <span class="nx">defaults</span><span class="p">.</span><span class="nx">maxScale</span> <span class="p">),</span>
                <span class="nx">minScale</span><span class="o">:</span> <span class="nx">toNumber</span><span class="p">(</span> <span class="nx">rootData</span><span class="p">.</span><span class="nx">minScale</span><span class="p">,</span> <span class="nx">defaults</span><span class="p">.</span><span class="nx">minScale</span> <span class="p">),</span>                
                <span class="nx">perspective</span><span class="o">:</span> <span class="nx">toNumber</span><span class="p">(</span> <span class="nx">rootData</span><span class="p">.</span><span class="nx">perspective</span><span class="p">,</span> <span class="nx">defaults</span><span class="p">.</span><span class="nx">perspective</span> <span class="p">),</span>
                <span class="nx">transitionDuration</span><span class="o">:</span> <span class="nx">toNumber</span><span class="p">(</span> <span class="nx">rootData</span><span class="p">.</span><span class="nx">transitionDuration</span><span class="p">,</span> <span class="nx">defaults</span><span class="p">.</span><span class="nx">transitionDuration</span> <span class="p">)</span>
            <span class="p">};</span>
            
            <span class="nx">windowScale</span> <span class="o">=</span> <span class="nx">computeWindowScale</span><span class="p">(</span> <span class="nx">config</span> <span class="p">);</span>
            </pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>wrap steps with "canvas" element</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">arrayify</span><span class="p">(</span> <span class="nx">root</span><span class="p">.</span><span class="nx">childNodes</span> <span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span> <span class="nx">el</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nx">canvas</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span> <span class="nx">el</span> <span class="p">);</span>
            <span class="p">});</span>
            <span class="nx">root</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">canvas</span><span class="p">);</span>
            </pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>set initial styles</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="s2">&quot;100%&quot;</span><span class="p">;</span>
            
            <span class="nx">css</span><span class="p">(</span><span class="nx">body</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">height</span><span class="o">:</span> <span class="s2">&quot;100%&quot;</span><span class="p">,</span>
                <span class="nx">overflow</span><span class="o">:</span> <span class="s2">&quot;hidden&quot;</span>
            <span class="p">});</span>
            
            <span class="kd">var</span> <span class="nx">rootStyles</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">position</span><span class="o">:</span> <span class="s2">&quot;absolute&quot;</span><span class="p">,</span>
                <span class="nx">transformOrigin</span><span class="o">:</span> <span class="s2">&quot;top left&quot;</span><span class="p">,</span>
                <span class="nx">transition</span><span class="o">:</span> <span class="s2">&quot;all 0s ease-in-out&quot;</span><span class="p">,</span>
                <span class="nx">transformStyle</span><span class="o">:</span> <span class="s2">&quot;preserve-3d&quot;</span>
            <span class="p">};</span>
            
            <span class="nx">css</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">rootStyles</span><span class="p">);</span>
            <span class="nx">css</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">top</span><span class="o">:</span> <span class="s2">&quot;50%&quot;</span><span class="p">,</span>
                <span class="nx">left</span><span class="o">:</span> <span class="s2">&quot;50%&quot;</span><span class="p">,</span>
                <span class="nx">transform</span><span class="o">:</span> <span class="nx">perspective</span><span class="p">(</span> <span class="nx">config</span><span class="p">.</span><span class="nx">perspective</span><span class="o">/</span><span class="nx">windowScale</span> <span class="p">)</span> <span class="o">+</span> <span class="nx">scale</span><span class="p">(</span> <span class="nx">windowScale</span> <span class="p">)</span>
            <span class="p">});</span>
            <span class="nx">css</span><span class="p">(</span><span class="nx">canvas</span><span class="p">,</span> <span class="nx">rootStyles</span><span class="p">);</span>
            
            <span class="nx">body</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">&quot;impress-disabled&quot;</span><span class="p">);</span>
            <span class="nx">body</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;impress-enabled&quot;</span><span class="p">);</span>
            </pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>get and init steps</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">steps</span> <span class="o">=</span> <span class="nx">$$</span><span class="p">(</span><span class="s2">&quot;.step&quot;</span><span class="p">,</span> <span class="nx">root</span><span class="p">);</span>
            <span class="nx">steps</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span> <span class="nx">initStep</span> <span class="p">);</span>
            </pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>set a default initial state of the canvas</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">currentState</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">translate</span><span class="o">:</span> <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">z</span><span class="o">:</span> <span class="mi">0</span> <span class="p">},</span>
                <span class="nx">rotate</span><span class="o">:</span>    <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">z</span><span class="o">:</span> <span class="mi">0</span> <span class="p">},</span>
                <span class="nx">scale</span><span class="o">:</span>     <span class="mi">1</span>
            <span class="p">};</span>
            
            <span class="nx">initialized</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            
            <span class="nx">triggerEvent</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="s2">&quot;impress:init&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">api</span><span class="o">:</span> <span class="nx">roots</span><span class="p">[</span> <span class="s2">&quot;impress-root-&quot;</span> <span class="o">+</span> <span class="nx">rootId</span> <span class="p">]</span> <span class="p">});</span>
        <span class="p">};</span>
        </pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p><code>getStep</code> is a helper function that returns a step element defined by parameter.
If a number is given, step with index given by the number is returned, if a string
is given step element with such id is returned, if DOM element is given it is returned
if it is a correct step element.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">getStep</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">step</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">step</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">step</span> <span class="o">=</span> <span class="nx">step</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">steps</span><span class="p">[</span> <span class="nx">steps</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="nx">step</span><span class="p">]</span> <span class="o">:</span> <span class="nx">steps</span><span class="p">[</span> <span class="nx">step</span> <span class="p">];</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">step</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">step</span> <span class="o">=</span> <span class="nx">byId</span><span class="p">(</span><span class="nx">step</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="p">(</span><span class="nx">step</span> <span class="o">&amp;&amp;</span> <span class="nx">step</span><span class="p">.</span><span class="nx">id</span> <span class="o">&amp;&amp;</span> <span class="nx">stepsData</span><span class="p">[</span><span class="s2">&quot;impress-&quot;</span> <span class="o">+</span> <span class="nx">step</span><span class="p">.</span><span class="nx">id</span><span class="p">])</span> <span class="o">?</span> <span class="nx">step</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">};</span>
        </pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>used to reset timeout for <code>impress:stepenter</code> event</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">stepEnterTimeout</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        </pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p><code>goto</code> API function that moves to step given with <code>el</code> parameter (by index, id or element),
with a transition <code>duration</code> optionally given as second parameter.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="kr">goto</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">duration</span> <span class="p">)</span> <span class="p">{</span>
            
            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">initialized</span> <span class="o">||</span> <span class="o">!</span><span class="p">(</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">getStep</span><span class="p">(</span><span class="nx">el</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>presentation not initialized or given element is not a step</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
            </pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Sometimes it's possible to trigger focus on first link with some keyboard action.
Browser in such a case tries to scroll the page to make this element visible
(even that body overflow is set to hidden) and it breaks our careful positioning.</p>

<p>So, as a lousy (and lazy) workaround we will make the page scroll back to the top
whenever slide is selected</p>

<p>If you are reading this and know any better way to handle it, I'll be glad to hear about it!</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
            
            <span class="kd">var</span> <span class="nx">step</span> <span class="o">=</span> <span class="nx">stepsData</span><span class="p">[</span><span class="s2">&quot;impress-&quot;</span> <span class="o">+</span> <span class="nx">el</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>
            
            <span class="k">if</span> <span class="p">(</span> <span class="nx">activeStep</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nx">activeStep</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">);</span>
                <span class="nx">body</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">&quot;impress-on-&quot;</span> <span class="o">+</span> <span class="nx">activeStep</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">el</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">);</span>
            
            <span class="nx">body</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;impress-on-&quot;</span> <span class="o">+</span> <span class="nx">el</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
            </pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>compute target state of the canvas based on given step</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">rotate</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">x</span><span class="o">:</span> <span class="o">-</span><span class="nx">step</span><span class="p">.</span><span class="nx">rotate</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
                    <span class="nx">y</span><span class="o">:</span> <span class="o">-</span><span class="nx">step</span><span class="p">.</span><span class="nx">rotate</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
                    <span class="nx">z</span><span class="o">:</span> <span class="o">-</span><span class="nx">step</span><span class="p">.</span><span class="nx">rotate</span><span class="p">.</span><span class="nx">z</span>
                <span class="p">},</span>
                <span class="nx">translate</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">x</span><span class="o">:</span> <span class="o">-</span><span class="nx">step</span><span class="p">.</span><span class="nx">translate</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span>
                    <span class="nx">y</span><span class="o">:</span> <span class="o">-</span><span class="nx">step</span><span class="p">.</span><span class="nx">translate</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>
                    <span class="nx">z</span><span class="o">:</span> <span class="o">-</span><span class="nx">step</span><span class="p">.</span><span class="nx">translate</span><span class="p">.</span><span class="nx">z</span>
                <span class="p">},</span>
                <span class="nx">scale</span><span class="o">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="nx">step</span><span class="p">.</span><span class="nx">scale</span>
            <span class="p">};</span>
            </pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Check if the transition is zooming in or not.</p>

<p>This information is used to alter the transition style:
when we are zooming in - we start with move and rotate transition
and the scaling is delayed, but when we are zooming out we start
with scaling down and move and rotation are delayed.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">zoomin</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">scale</span> <span class="o">&gt;=</span> <span class="nx">currentState</span><span class="p">.</span><span class="nx">scale</span><span class="p">;</span>
            
            <span class="nx">duration</span> <span class="o">=</span> <span class="nx">toNumber</span><span class="p">(</span><span class="nx">duration</span><span class="p">,</span> <span class="nx">config</span><span class="p">.</span><span class="nx">transitionDuration</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">delay</span> <span class="o">=</span> <span class="p">(</span><span class="nx">duration</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
            </pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>if the same step is re-selected, force computing window scaling,
because it is likely to be caused by window resize</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">el</span> <span class="o">===</span> <span class="nx">activeStep</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">windowScale</span> <span class="o">=</span> <span class="nx">computeWindowScale</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
            <span class="p">}</span>
            
            <span class="kd">var</span> <span class="nx">targetScale</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">scale</span> <span class="o">*</span> <span class="nx">windowScale</span><span class="p">;</span>
            </pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>trigger leave of currently active element (if it's not the same step again)</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">activeStep</span> <span class="o">&amp;&amp;</span> <span class="nx">activeStep</span> <span class="o">!==</span> <span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">onStepLeave</span><span class="p">(</span><span class="nx">activeStep</span><span class="p">);</span>
            <span class="p">}</span>
            </pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Now we alter transforms of <code>root</code> and <code>canvas</code> to trigger transitions.</p>

<p>And here is why there are two elements: <code>root</code> and <code>canvas</code> - they are
being animated separately:
<code>root</code> is used for scaling and <code>canvas</code> for translate and rotations.
Transitions on them are triggered with different delays (to make
visually nice and 'natural' looking transitions), so we need to know
that both of them are finished.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">css</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>to keep the perspective look similar for different scales
we need to 'scale' the perspective, too</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">transform</span><span class="o">:</span> <span class="nx">perspective</span><span class="p">(</span> <span class="nx">config</span><span class="p">.</span><span class="nx">perspective</span> <span class="o">/</span> <span class="nx">targetScale</span> <span class="p">)</span> <span class="o">+</span> <span class="nx">scale</span><span class="p">(</span> <span class="nx">targetScale</span> <span class="p">),</span>
                <span class="nx">transitionDuration</span><span class="o">:</span> <span class="nx">duration</span> <span class="o">+</span> <span class="s2">&quot;ms&quot;</span><span class="p">,</span>
                <span class="nx">transitionDelay</span><span class="o">:</span> <span class="p">(</span><span class="nx">zoomin</span> <span class="o">?</span> <span class="nx">delay</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;ms&quot;</span>
            <span class="p">});</span>
            
            <span class="nx">css</span><span class="p">(</span><span class="nx">canvas</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">transform</span><span class="o">:</span> <span class="nx">rotate</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">rotate</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">+</span> <span class="nx">translate</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">translate</span><span class="p">),</span>
                <span class="nx">transitionDuration</span><span class="o">:</span> <span class="nx">duration</span> <span class="o">+</span> <span class="s2">&quot;ms&quot;</span><span class="p">,</span>
                <span class="nx">transitionDelay</span><span class="o">:</span> <span class="p">(</span><span class="nx">zoomin</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">delay</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;ms&quot;</span>
            <span class="p">});</span>
            </pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Here is a tricky part...</p>

<p>If there is no change in scale or no change in rotation and translation, it means there was actually
no delay - because there was no transition on <code>root</code> or <code>canvas</code> elements.
We want to trigger <code>impress:stepenter</code> event in the correct moment, so here we compare the current
and target values to check if delay should be taken into account.</p>

<p>I know that this <code>if</code> statement looks scary, but it's pretty simple when you know what is going on
- it's simply comparing all the values.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span> <span class="nx">currentState</span><span class="p">.</span><span class="nx">scale</span> <span class="o">===</span> <span class="nx">target</span><span class="p">.</span><span class="nx">scale</span> <span class="o">||</span>
                <span class="p">(</span><span class="nx">currentState</span><span class="p">.</span><span class="nx">rotate</span><span class="p">.</span><span class="nx">x</span> <span class="o">===</span> <span class="nx">target</span><span class="p">.</span><span class="nx">rotate</span><span class="p">.</span><span class="nx">x</span> <span class="o">&amp;&amp;</span> <span class="nx">currentState</span><span class="p">.</span><span class="nx">rotate</span><span class="p">.</span><span class="nx">y</span> <span class="o">===</span> <span class="nx">target</span><span class="p">.</span><span class="nx">rotate</span><span class="p">.</span><span class="nx">y</span> <span class="o">&amp;&amp;</span>
                 <span class="nx">currentState</span><span class="p">.</span><span class="nx">rotate</span><span class="p">.</span><span class="nx">z</span> <span class="o">===</span> <span class="nx">target</span><span class="p">.</span><span class="nx">rotate</span><span class="p">.</span><span class="nx">z</span> <span class="o">&amp;&amp;</span> <span class="nx">currentState</span><span class="p">.</span><span class="nx">translate</span><span class="p">.</span><span class="nx">x</span> <span class="o">===</span> <span class="nx">target</span><span class="p">.</span><span class="nx">translate</span><span class="p">.</span><span class="nx">x</span> <span class="o">&amp;&amp;</span>
                 <span class="nx">currentState</span><span class="p">.</span><span class="nx">translate</span><span class="p">.</span><span class="nx">y</span> <span class="o">===</span> <span class="nx">target</span><span class="p">.</span><span class="nx">translate</span><span class="p">.</span><span class="nx">y</span> <span class="o">&amp;&amp;</span> <span class="nx">currentState</span><span class="p">.</span><span class="nx">translate</span><span class="p">.</span><span class="nx">z</span> <span class="o">===</span> <span class="nx">target</span><span class="p">.</span><span class="nx">translate</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nx">delay</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
            </pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>store current state</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">currentState</span> <span class="o">=</span> <span class="nx">target</span><span class="p">;</span>
            <span class="nx">activeStep</span> <span class="o">=</span> <span class="nx">el</span><span class="p">;</span>
            </pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>And here is where we trigger <code>impress:stepenter</code> event.
We simply set up a timeout to fire it taking transition duration (and possible delay) into account.</p>

<p>I really wanted to make it in more elegant way. The <code>transitionend</code> event seemed to be the best way
to do it, but the fact that I'm using transitions on two separate elements and that the <code>transitionend</code>
event is only triggered when there was a transition (change in the values) caused some bugs and 
made the code really complicated, cause I had to handle all the conditions separately. And it still
needed a <code>setTimeout</code> fallback for the situations when there is no transition at all.
So I decided that I'd rather make the code simpler than use shiny new <code>transitionend</code>.</p>

<p>If you want learn something interesting and see how it was done with <code>transitionend</code> go back to
version 0.5.2 of impress.js: http://github.com/bartaz/impress.js/blob/0.5.2/js/impress.js</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nb">window</span><span class="p">.</span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">stepEnterTimeout</span><span class="p">);</span>
            <span class="nx">stepEnterTimeout</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">onStepEnter</span><span class="p">(</span><span class="nx">activeStep</span><span class="p">);</span>
            <span class="p">},</span> <span class="nx">duration</span> <span class="o">+</span> <span class="nx">delay</span><span class="p">);</span>
            
            <span class="k">return</span> <span class="nx">el</span><span class="p">;</span>
        <span class="p">};</span>
        </pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p><code>prev</code> API function goes to previous step (in document order)</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">prev</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">prev</span> <span class="o">=</span> <span class="nx">steps</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span> <span class="nx">activeStep</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
            <span class="nx">prev</span> <span class="o">=</span> <span class="nx">prev</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">steps</span><span class="p">[</span> <span class="nx">prev</span> <span class="p">]</span> <span class="o">:</span> <span class="nx">steps</span><span class="p">[</span> <span class="nx">steps</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span> <span class="p">];</span>
            
            <span class="k">return</span> <span class="kr">goto</span><span class="p">(</span><span class="nx">prev</span><span class="p">);</span>
        <span class="p">};</span>
        </pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p><code>next</code> API function goes to next step (in document order)</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">next</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">next</span> <span class="o">=</span> <span class="nx">steps</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span> <span class="nx">activeStep</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="nx">next</span> <span class="o">=</span> <span class="nx">next</span> <span class="o">&lt;</span> <span class="nx">steps</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">steps</span><span class="p">[</span> <span class="nx">next</span> <span class="p">]</span> <span class="o">:</span> <span class="nx">steps</span><span class="p">[</span> <span class="mi">0</span> <span class="p">];</span>
            
            <span class="k">return</span> <span class="kr">goto</span><span class="p">(</span><span class="nx">next</span><span class="p">);</span>
        <span class="p">};</span>
        </pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>Adding some useful classes to step elements.</p>

<p>All the steps that have not been shown yet are given <code>future</code> class.
When the step is entered the <code>future</code> class is removed and the <code>present</code>
class is given. When the step is left <code>present</code> class is replaced with
<code>past</code> class.</p>

<p>So every step element is always in one of three possible states:
<code>future</code>, <code>present</code> and <code>past</code>.</p>

<p>There classes can be used in CSS to style different types of steps.
For example the <code>present</code> class can be used to trigger some custom
animations when step is shown.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">root</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;impress:init&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>STEP CLASSES</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">steps</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">step</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">step</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;future&quot;</span><span class="p">);</span>
            <span class="p">});</span>
            
            <span class="nx">root</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;impress:stepenter&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">&quot;past&quot;</span><span class="p">);</span>
                <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">&quot;future&quot;</span><span class="p">);</span>
                <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;present&quot;</span><span class="p">);</span>
            <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
            
            <span class="nx">root</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;impress:stepleave&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">&quot;present&quot;</span><span class="p">);</span>
                <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;past&quot;</span><span class="p">);</span>
            <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
            
        <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
        </pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>Adding hash change support.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">root</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;impress:init&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
            </pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>last hash detected</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">lastHash</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
            </pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p><code>#/step-id</code> is used instead of <code>#step-id</code> to prevent default browser
scrolling to element in hash.</p>

<p>And it has to be set after animation finishes, because in Chrome it
makes transtion laggy.
BUG: http://code.google.com/p/chromium/issues/detail?id=62820</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">root</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;impress:stepenter&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
                <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="nx">lastHash</span> <span class="o">=</span> <span class="s2">&quot;#/&quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
            <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
            
            <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;hashchange&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>When the step is entered hash in the location is updated
(just few lines above from here), so the hash change is 
triggered and we would call <code>goto</code> again on the same element.</p>

<p>To avoid this we store last entered hash and compare.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">!==</span> <span class="nx">lastHash</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kr">goto</span><span class="p">(</span> <span class="nx">getElementFromHash</span><span class="p">()</span> <span class="p">);</span>
                <span class="p">}</span>
            <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
            </pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>START 
by selecting step defined in url or first step of the presentation</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kr">goto</span><span class="p">(</span><span class="nx">getElementFromHash</span><span class="p">()</span> <span class="o">||</span> <span class="nx">steps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
        
        <span class="nx">body</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;impress-disabled&quot;</span><span class="p">);</span>
        </pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>store and return API for given impress.js root element</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="p">(</span><span class="nx">roots</span><span class="p">[</span> <span class="s2">&quot;impress-root-&quot;</span> <span class="o">+</span> <span class="nx">rootId</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">init</span><span class="o">:</span> <span class="nx">init</span><span class="p">,</span>
            <span class="kr">goto</span><span class="o">:</span> <span class="kr">goto</span><span class="p">,</span>
            <span class="nx">next</span><span class="o">:</span> <span class="nx">next</span><span class="p">,</span>
            <span class="nx">prev</span><span class="o">:</span> <span class="nx">prev</span>
        <span class="p">});</span>

    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>flag that can be used in JS to check if browser have passed the support test</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">impress</span><span class="p">.</span><span class="nx">supported</span> <span class="o">=</span> <span class="nx">impressSupported</span><span class="p">;</span>
    
<span class="p">})(</span><span class="nb">document</span><span class="p">,</span> <span class="nb">window</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>NAVIGATION EVENTS</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>As you can see this part is separate from the impress.js core code.
It's because these navigation actions only need what impress.js provides with
its simple API.</p>

<p>In future I think about moving it to make them optional, move to separate files
and treat more like a 'plugins'.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span> <span class="nb">document</span><span class="p">,</span> <span class="nb">window</span> <span class="p">)</span> <span class="p">{</span>
    <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>throttling function calls, by Remy Sharp
http://remysharp.com/2010/07/21/throttling-function-calls/</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">throttle</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">delay</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">timer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">;</span>
            <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>
            <span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
            <span class="p">},</span> <span class="nx">delay</span><span class="p">);</span>
        <span class="p">};</span>
    <span class="p">};</span>
    </pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>wait for impress.js to be initialized</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;impress:init&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>Getting API from event data.
So you don't event need to know what is the id of the root element
or anything. <code>impress:init</code> event data gives you everything you 
need to control the presentation that was just initialized.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">api</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">api</span><span class="p">;</span>
        </pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>KEYBOARD NAVIGATION HANDLERS</p>             </td>             <td class="code">               <div class="highlight"><pre>        </pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>Prevent default keydown action when one of supported key is pressed.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;keydown&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="mi">9</span> <span class="o">||</span> <span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">&gt;=</span> <span class="mi">32</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">&lt;=</span> <span class="mi">34</span> <span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">&gt;=</span> <span class="mi">37</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">&lt;=</span> <span class="mi">40</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
        </pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>Trigger impress action (next or prev) on keyup.</p>             </td>             <td class="code">               <div class="highlight"><pre>        </pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>Supported keys are:
[space] - quite common in presentation software to move forward
[up] [right] / [down] [left] - again common and natural addition,
[pgdown] / [pgup] - often triggered by remote controllers,
[tab] - this one is quite controversial, but the reason it ended up on
  this list is quite an interesting story... Remember that strange part
  in the impress.js code where window is scrolled to 0,0 on every presentation
  step, because sometimes browser scrolls viewport because of the focused element?
  Well, the [tab] key by default navigates around focusable elements, so clicking
  it very often caused scrolling to focused element and breaking impress.js
  positioning. I didn't want to just prevent this default action, so I used [tab]
  as another way to moving to next step... And yes, I know that for the sake of
  consistency I should add [shift+tab] as opposite action...</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;keyup&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="mi">9</span> <span class="o">||</span> <span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">&gt;=</span> <span class="mi">32</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">&lt;=</span> <span class="mi">34</span> <span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">&gt;=</span> <span class="mi">37</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">&lt;=</span> <span class="mi">40</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                <span class="k">switch</span><span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="mi">33</span><span class="o">:</span> <span class="c1">// pg up</span>
                    <span class="k">case</span> <span class="mi">37</span><span class="o">:</span> <span class="c1">// left</span>
                    <span class="k">case</span> <span class="mi">38</span><span class="o">:</span> <span class="c1">// up</span>
                             <span class="nx">api</span><span class="p">.</span><span class="nx">prev</span><span class="p">();</span>
                             <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="mi">9</span><span class="o">:</span>  <span class="c1">// tab</span>
                    <span class="k">case</span> <span class="mi">32</span><span class="o">:</span> <span class="c1">// space</span>
                    <span class="k">case</span> <span class="mi">34</span><span class="o">:</span> <span class="c1">// pg down</span>
                    <span class="k">case</span> <span class="mi">39</span><span class="o">:</span> <span class="c1">// right</span>
                    <span class="k">case</span> <span class="mi">40</span><span class="o">:</span> <span class="c1">// down</span>
                             <span class="nx">api</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
                             <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
                
                <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
        </pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>delegated handler for clicking on the links to presentation steps</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>event delegation with "bubbling"
check if event target (or any of its parents is a link)</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span> <span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">!==</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                    <span class="p">(</span><span class="nx">target</span> <span class="o">!==</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nx">target</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
            <span class="p">}</span>
            
            <span class="k">if</span> <span class="p">(</span> <span class="nx">target</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">===</span> <span class="s2">&quot;A&quot;</span> <span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">href</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">);</span>
                </pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>if it's a link to presentation step, target this step</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span> <span class="nx">href</span> <span class="o">&amp;&amp;</span> <span class="nx">href</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;#&#39;</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="nx">target</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span> <span class="nx">href</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            
            <span class="k">if</span> <span class="p">(</span> <span class="nx">api</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nx">event</span><span class="p">.</span><span class="nx">stopImmediatePropagation</span><span class="p">();</span>
                <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
        </pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>delegated handler for clicking on step elements</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>find closest step element that is not active</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">while</span> <span class="p">(</span> <span class="o">!</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">target</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
                    <span class="p">(</span><span class="nx">target</span> <span class="o">!==</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nx">target</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
            <span class="p">}</span>
            
            <span class="k">if</span> <span class="p">(</span> <span class="nx">api</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
        </pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>touch handler to detect taps on the left and right side of the screen
based on awesome work of @hakimel: https://github.com/hakimel/reveal.js</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;touchstart&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">touches</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">clientX</span><span class="p">,</span>
                    <span class="nx">width</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">,</span>
                    <span class="nx">result</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                    
                <span class="k">if</span> <span class="p">(</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">width</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="nx">result</span> <span class="o">=</span> <span class="nx">api</span><span class="p">.</span><span class="nx">prev</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">-</span> <span class="nx">width</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="nx">result</span> <span class="o">=</span> <span class="nx">api</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
                <span class="p">}</span>
                
                <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
        </pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>rescale presentation when window is resized</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;resize&quot;</span><span class="p">,</span> <span class="nx">throttle</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>force going to active step again, to trigger rescaling</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">api</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;.active&quot;</span><span class="p">),</span> <span class="mi">500</span> <span class="p">);</span>
        <span class="p">},</span> <span class="mi">250</span><span class="p">),</span> <span class="kc">false</span><span class="p">);</span>
        
    <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
        
<span class="p">})(</span><span class="nb">document</span><span class="p">,</span> <span class="nb">window</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>THAT'S ALL FOLKS!</p>

<p>Thanks for reading it all.
Or thanks for scrolling down and reading the last part.</p>

<p>I've learnt a lot when building impress.js and I hope this code and comments
will help somebody learn at least some part of it.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 